package com.tuneit.itc.contacts.claims;

import lombok.Data;

import java.io.Serializable;

import javax.annotation.PostConstruct;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.ManagedProperty;
import javax.faces.bean.ViewScoped;
import javax.mail.internet.AddressException;
import javax.mail.internet.InternetAddress;

import com.liferay.faces.portal.context.LiferayPortletHelperUtil;
import com.liferay.mail.kernel.model.MailMessage;
import com.liferay.mail.kernel.service.MailServiceUtil;
import com.liferay.portal.kernel.log.LogFactoryUtil;
import com.liferay.portal.kernel.theme.ThemeDisplay;
import com.liferay.portal.kernel.util.PrefsPropsUtil;
import com.liferay.portal.kernel.util.PropsKeys;

import com.tuneit.itc.commons.jsf.LocalizedFacesMessage;
import com.tuneit.itc.commons.model.OrganizationRegistrationClaim;
import com.tuneit.itc.commons.service.OrganizationRegistrationService;

@Data
@ManagedBean
@ViewScoped
public class ClaimCreationBean implements Serializable {

    private OrganizationRegistrationClaim claim;

    @ManagedProperty("#{organizationRegistrationService}")
    private OrganizationRegistrationService service;

    private static final String SUBJECT = "Интернет-магазин ITC Electronics: заявка на регистрацию";
    // CHECKSTYLE:OFF
    private static final String BODY = "<p>Здравствуйте!</p>\n" +
            "\n" +
            "<p>Ваша заявка на регистрацию в <a href=\"%s\">интернет-магазине компании ITC Electronics</a> была принята.</p>\n" +
            "\n" +
            "<p>Номер заявки: %d.</p>\n" +
            "<p>--<br />\n" +
            "С уважением,<br />\n" +
            "служба поддержки интернет-магазина ITC Electronics</p>\n" +
            "\n" +
            "<p><img height=\"132\" src=\"data:image/png;base64,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\" width=\"174\" /></p>\n";
    // CHECKSTYLE:ON

    @PostConstruct
    public void init() {
        initClaim();
    }

    public void create() {
        try {
            InternetAddress internetAddress = new InternetAddress(claim.getEmail());
            ThemeDisplay td = LiferayPortletHelperUtil.getThemeDisplay();
            long companyId = td.getCompanyId();
            String fromAddress = PrefsPropsUtil.getString(companyId, PropsKeys.ADMIN_EMAIL_FROM_ADDRESS);
            String fromName = PrefsPropsUtil.getString(companyId, PropsKeys.ADMIN_EMAIL_FROM_NAME);
            InternetAddress from = new InternetAddress(fromAddress, fromName);
            String url = td.getPortalURL();
            var savedClaim = service.save(claim);
            MailMessage mailMessage = new MailMessage();
            mailMessage.setFrom(from);
            mailMessage.setTo(internetAddress);
            mailMessage.setBody(String.format(BODY, url, savedClaim.getId()));
            mailMessage.setHTMLFormat(true);
            mailMessage.setSubject(SUBJECT);
            MailServiceUtil.sendEmail(mailMessage);
            initClaim();
            LocalizedFacesMessage.infoFormat("itc.admin.claim.created", new Long[]{savedClaim.getId()});
        } catch (AddressException ae) {
            LocalizedFacesMessage.error("itc.admin.invalid-email");
        } catch (Exception e) {
            LogFactoryUtil.getLog(ClaimCreationBean.class).warn("Can not create claim!", e);
            LocalizedFacesMessage.error("itc.admin.contractor.unknown-error");
        }
    }

    private void initClaim() {
        this.claim = new OrganizationRegistrationClaim();
        this.claim.setActive(true);
        this.claim.setJuridicalPerson(true);
    }
}
